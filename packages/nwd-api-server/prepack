#!/bin/sh

set -e

cd $(dirname $0)

PACKAGES=$(cat package.json | jq --raw-output ".bundledDependencies[]")

rm -rf node_modules
mkdir --parents node_modules

for PACKAGE in $PACKAGES; do
  mkdir --parents .bundle-tmp/$PACKAGE
  npm --workspace $PACKAGE pack --pack-destination .bundle-tmp/$PACKAGE
  tar --extract --file .bundle-tmp/$PACKAGE/$PACKAGE-0.0.0.tgz --directory .bundle-tmp/$PACKAGE
  mv .bundle-tmp/$PACKAGE/package node_modules/$PACKAGE
done

rm -rf .bundle-tmp
